<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Course 2 Delivery</title>
  <link rel="stylesheet" href="coursesstyles.css">
</head>
<body>
<div class="learningArea">
  <!-- Sidebar -->
  <div class="sidebar" id="lessonList"></div>

  <!-- Main Area -->
  <div class="mainArea" id="lessonDetail"></div>
</div>

<!-- Script section -->
<script>
let completedLessons = [];
let xpTotal = 0;
let auditTrail = [];
let lessonsData = { lessons: [] }; // initialize safely

// Fetch lessons from JSON

fetch("./course2.json")
  .then(res => {
    if (!res.ok) {
      throw new Error(`HTTP error! Status: ${res.status}`);
    }
    return res.json();
  })
  .then(data => {
    lessonsData = data.lessons ? data : { lessons: [data] };
    populateSidebar();
    showWelcome();
  })
  .catch(err => {
    console.error("Error loading course2.json:", err);
    const detail = document.getElementById("lessonDetail");
    detail.innerHTML = `
      <h3>Error Loading Lessons</h3>
      <p>${err.message}</p>
      <p>Ensure course2.json is in the correct folder and served via a local server.</p>
    `;
  });

// Welcome screen
function showWelcome() {
  const detail = document.getElementById("lessonDetail");
  detail.innerHTML = `
    <h3>Welcome to Course 2: AI-Powered Digital Tool Development for Industry-Specific Problem Solving
</h3>
    <div class="subCard descCard">
      <p>This experiential course is designed to empower youth, MSMEs, and sponsors by guiding them through the process of creating AI-powered digital tools to address real-world challenges in their respective industries. Participants will learn foundational AI and machine learning (ML) concepts, apply them to solve problems, and gain hands-on experience through structured workflows. The course follows Kolb's Experiential Learning Framework (Experience, Reflection, Conceptualization, Application) and rewards progress through milestones and XP (experience points). Each lesson builds upon the last, with a focus on practical outcomes and self-directed exploration.</p>
      <p>Complete all lessons to earn your badge and track progress transparently.</p>
      ${lessonsData.lessons.length > 0 ? 
        `<button class="btn" onclick="showLesson(lessonsData.lessons[0])">Start Lesson 1</button>` : 
        `<p>No lessons available.</p>`}
    </div>
  `;
}

// Sidebar
function populateSidebar() {
  const lessonList = document.getElementById("lessonList");
  lessonList.innerHTML = "<h2>Course 2</h2>";

  lessonsData.lessons.forEach(lesson => {
    const card = document.createElement("div");
    card.className = "card";
    card.textContent = lesson.title;
    card.onclick = () => showLesson(lesson);
    lessonList.appendChild(card);
  });

  // Audit Trail card
  const auditCard = document.createElement("div");
  auditCard.className = "card";
  auditCard.textContent = "Audit Trail";
  auditCard.onclick = () => showAuditTrail();
  lessonList.appendChild(auditCard);
}

// Lesson Renderer
function showLesson(lesson) {
  const detail = document.getElementById("lessonDetail");
  detail.innerHTML = `
    <h3>${lesson.title}</h3>
    <div class="subCard descCard"><p>${lesson.description}</p></div>
    <div class="subCard exampleCard"><p>Example: ${lesson.example}</p></div>
    ${renderKolbCycle(lesson)}
    ${renderLearnerReport(lesson)}
    ${renderXP(lesson)}
    ${renderFeedback()}
  `;
}

// Render Kolb Cycle using instructions
function renderKolbCycle(lesson) {
  return `
    <div class="subCard instructionsCard">
      ${Object.keys(lesson.instructions).map(stage => `
        <div class="instructionTitle">${stage.charAt(0).toUpperCase()+stage.slice(1)}:</div>
        <div>${lesson.instructions[stage]}</div>
      `).join("")}
    </div>
  `;
}

// Learner Report
function renderLearnerReport(lesson) {
  return `
    <div class="subCard learnerCard">
      <p>Learner Report:</p>
      <textarea id="report-${lesson.id}" placeholder="Write your reflection here"></textarea>
      <input type="file" id="file-${lesson.id}" accept="audio/*,video/*,image/*">
      <textarea id="caption-${lesson.id}" placeholder="Add a narration caption"></textarea>
      <button class="btn" onclick="submitReport(${lesson.id})">Submit Report</button>
    </div>
  `;
}

// XP Renderer
function renderXP(lesson) {
  return `
    <div class="subCard xpCard">
      <div>XP Award: ${lesson.xpAward}</div>
      <div>${lesson.northPoleReminder}</div>
      <div>${lesson.badgeReminder}</div>
      <button class="btn" onclick="approveLesson(${lesson.id})">Manager Approval</button>
    </div>
  `;
}

// Feedback Renderer
function renderFeedback() {
  return `
    <div class="subCard feedbackCard">
      <p>Peer Feedback:</p>
      <input type="text" placeholder="Peers can leave encouragement here">
      <p>Facilitator Feedback:</p>
      <input type="text" placeholder="Facilitator can add comments here">
    </div>
  `;
}

// Submit Report
function submitReport(lessonId) {
  const lesson = lessonsData.lessons.find(l => l.id === lessonId);
  const reportText = document.getElementById(`report-${lesson.id}`).value.trim();
  const fileInput = document.getElementById(`file-${lesson.id}`);
  const captionText = document.getElementById(`caption-${lesson.id}`).value.trim();

  if (!reportText && !fileInput.files.length) {
    alert("Please provide either a reflection or upload a file.");
    return;
  }

  lesson.learnerReport = {
    text: reportText,
    fileName: fileInput.files.length ? fileInput.files[0].name : null,
    caption: captionText
  };

  auditTrail.push({
    lessonId: lesson.id,
    action: "Report Submitted",
    learnerReport: lesson.learnerReport,
    timestamp: new Date().toISOString()
  });

  alert("Report submitted. Awaiting Manager Approval.");
}

// Approve Lesson
function approveLesson(lessonId) {
  const lesson = lessonsData.lessons.find(l => l.id === lessonId);
  if (lesson.learnerReport && (lesson.learnerReport.text || lesson.learnerReport.fileName)) {
    if (!completedLessons.includes(lessonId)) {
      completedLessons.push(lessonId);
      xpTotal += lesson.xpAward;
      auditTrail.push({
        lessonId: lesson.id,
        action: "Lesson Approved",
        xpAwarded: lesson.xpAward,
        xpTotal: xpTotal,
        timestamp: new Date().toISOString()
      });
      alert(`Lesson ${lesson.id} approved. XP total: ${xpTotal}`);
    }
  } else {
    alert("Learner must submit a report before approval.");
  }
}

// Audit Trail Viewer
function showAuditTrail() {
  const detail = document.getElementById("lessonDetail");
  detail.innerHTML = `
    <h3>Audit Trail</h3>
    <div class="subCard descCard">
      ${auditTrail.length === 0 ? "<p>No activity logged yet.</p>" :
        auditTrail.map(log => `
          <p><strong>${log.action}</strong> for Lesson ${log.lessonId} at ${log.timestamp}</p>
          ${log.learnerReport ? `<p>Report: ${log.learnerReport.text || ""} | File: ${log.learnerReport.fileName || "None"} | Caption: ${log.learnerReport.caption || ""}</p>` : ""}
          ${log.xpAwarded ? `<p>XP Awarded: ${log.xpAwarded} | Total XP: ${log.xpTotal}</p>` : ""}
        `).join("")}
    </div>
  `;
}
<script src="js/main.js">
</script>
</body>
</html>
